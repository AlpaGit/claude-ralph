Ralph Desktop Orchestrator - Progress Tracker
===============================================

p1-02: Implement DB migration system            [DONE]
  - MigrationRunner class (src/main/runtime/migrations/migration-runner.ts)
  - Creates schema_migrations table to track applied migrations
  - Scans numbered .sql files from disk, sorts by numeric prefix
  - Applies unapplied migrations in order within transactions
  - 001_initial.sql (resources/migrations/001_initial.sql)
  - Current schema with IF NOT EXISTS guards for existing DBs
  - AppDatabase constructor updated to accept migrationsDir param
  - Replaces inline CREATE TABLE with MigrationRunner.run()
  - index.ts updated to resolve migrationsDir (dev vs packaged)

p1-03: Extract theme tokens into tokens.css       [DONE]
  - Created src/renderer/tokens.css with all CSS custom properties
  - Fonts: --font-sans (Space Grotesk), --font-mono (IBM Plex Mono)
  - Colors: core palette, gradients, surfaces, borders, wizard, thinking, status, feedback, log
  - Border radius: --radius-sm (8px) through --radius-circle (999px)
  - Box shadows: --shadow-hero, --shadow-panel
  - Transitions: --transition-fast (100ms ease-in-out)
  - Spacing: --space-xs through --space-xl
  - Layout: --max-width-app, --opacity-disabled
  - Updated src/renderer/styles.css to @import ./tokens.css
  - Replaced all hardcoded hex colors, font-family, border-radius, shadows with var() refs
  - Removed :root block from styles.css (moved to tokens.css)
  - Build and typecheck pass

p1-08: Install and configure Zustand stores       [DONE]
  - Installed zustand@5 and immer@10 as production dependencies
  - src/renderer/stores/planStore.ts
    - State: currentPlan, plansList, loadingPlan, loadingList, creating, error
    - Actions: createPlan, loadPlan, loadPlanList, deletePlan, archivePlan, clearError
    - Wraps window.ralphApi.createPlan and getPlan; list/delete/archive are stubs pending backend IPC
  - src/renderer/stores/runStore.ts
    - State: activeRuns map, runLogs map, runTodos map, selectedRunId, recentEvents
    - Actions: startRun, cancelRun, appendLog, appendTodo, selectRun
    - Uses immer middleware for efficient nested map updates
    - initRunEventSubscription() exported for one-time setup from App.tsx
    - Internal _handleRunEvent dispatches started/log/todo_update/completed/failed/cancelled events
  - src/renderer/stores/discoveryStore.ts
    - State: interview, answers, events, loading, error
    - Actions: startDiscovery, continueDiscovery, reset
    - Subscribes to onDiscoveryEvent during startDiscovery; cleans up on reset
  - src/renderer/stores/settingsStore.ts
    - State: modelConfig map (planning/discovery/execution/wizard roles), loading, error
    - Actions: loadSettings, updateModelForRole
    - Defaults all roles to claude-opus-4-6; stubs pending backend settings IPC
  - Build and typecheck pass

p1-04: Create UButton component with CSS Module   [DONE]
  - src/renderer/components/ui/UButton.tsx
    - forwardRef component accepting all ButtonHTMLAttributes
    - Variants: primary, secondary, ghost, danger (default: primary)
    - Sizes: sm, md, lg (default: md)
    - Loading state: renders a CSS spinner, sets aria-busy, disables interaction
    - Disabled state: reduced opacity, not-allowed cursor
    - Exports UButtonProps, UButtonVariant, UButtonSize types
    - Uses simple cn() helper for conditional class composition (no clsx dep)
  - src/renderer/components/ui/UButton.module.css
    - Extracted .action-btn base + variant styles from styles.css into CSS Module
    - Brutalist style: 2px solid border, bold weight, Space Grotesk font
    - Hover translateY(-1px), active translateY(0) micro-interaction
    - focus-visible outline (2px solid accent, 2px offset) for accessibility
    - Size presets with appropriate padding and font-size
    - Loading spinner via CSS animation (border-based spinner)
    - All values reference tokens.css custom properties
  - Build and typecheck pass

p1-05: Create UCard, UStatusPill, UInput, UTextArea components  [DONE]
  - src/renderer/components/UCard/UCard.tsx
    - Bordered panel container with optional title, subtitle, headerAction, footer slots
    - Uses consistent padding/margin via tokens.css spacing variables
    - Accepts children as body content, className for composition
  - src/renderer/components/UCard/UCard.module.css
    - Extracted .panel / .panel-header patterns from styles.css into CSS Module
    - Flex column layout with gap, dashed border footer separator
  - src/renderer/components/UStatusPill/UStatusPill.tsx
    - Colored badge for plan/task/run status values with automatic color mapping
    - STATUS_COLOR_MAP: pending=#6b7280, in_progress=#d97706, completed=#15803d,
      failed=#b91c1c, cancelled=#6b7280, draft=#6b7280, ready=#156f67,
      running=#d97706, queued=#6b7280
    - Optional colored dot indicator, label override, className
    - Uses CSS custom properties (--pill-color, --pill-bg) for dynamic styling
  - src/renderer/components/UStatusPill/UStatusPill.module.css
    - Extracted .status-pill / .status-* patterns from styles.css into CSS Module
    - Pill border radius, mono font, uppercase text transform
  - src/renderer/components/UInput/UInput.tsx
    - Text input with label, error state, helper text
    - Extends InputHTMLAttributes for full native input API passthrough
    - Auto-generates id via useId, wires label/aria-describedby/aria-invalid
  - src/renderer/components/UInput/UInput.module.css
    - Extracted .text-input / .label patterns from styles.css into CSS Module
    - Focus state with accent-2 border, disabled opacity, error border color
  - src/renderer/components/UTextArea/UTextArea.tsx
    - Multi-line textarea with label, error state, char count, and auto-resize
    - Extends TextareaHTMLAttributes for full native textarea API passthrough
    - Auto-resize via ref + scrollHeight measurement on change and value update
    - Live character counter with over-limit warning when maxLength is set
  - src/renderer/components/UTextArea/UTextArea.module.css
    - Extracted .text-area / .label patterns from styles.css into CSS Module
    - Footer row with justified error/helper text and char count
    - Auto-resize class disables manual resize and hides overflow
  - src/renderer/components/ui.ts -- barrel export for all four UI primitives
  - Build and typecheck pass

p1-06: Create UModal and USkeleton components   [DONE]
  - src/renderer/components/UModal/UModal.tsx
    - UModal: dialog overlay with title, body (children), footer actions, close button
    - Uses React.createPortal to render outside component tree (creates #u-modal-root)
    - Backdrop click-to-close, Escape key to close
    - aria-modal, role="dialog", aria-label for accessibility
    - Focus trap: Tab/Shift+Tab cycles through focusable elements inside dialog
    - Saves and restores focus on open/close
    - Locks body scroll while open
    - UConfirmModal: convenience wrapper with confirm/cancel buttons
    - Supports confirmVariant ("primary" | "danger"), loading state, custom labels
    - Exports UModalProps, UConfirmModalProps types
  - src/renderer/components/UModal/UModal.module.css
    - Brutalist panel styling: 2px solid border, --radius-panel, --shadow-panel
    - Backdrop with rgba overlay and fade-in animation
    - Dialog slide-up + scale entrance animation (150ms ease-out)
    - Header with title and close button, dashed border footer separator
    - Close button with hover translateY(-1px) micro-interaction
    - focus-visible outline for accessibility
    - All values reference tokens.css custom properties
  - src/renderer/components/USkeleton/USkeleton.tsx
    - Animated placeholder for loading states
    - Variants: text (line), card (rectangle), circle (avatar)
    - Configurable width, height, lines (multi-line text), lineGap
    - Multi-line text variant: last line shorter (65%) for natural appearance
    - role="status" and aria-label="Loading" for accessibility
    - Exports USkeletonProps, USkeletonVariant types
  - src/renderer/components/USkeleton/USkeleton.module.css
    - Pulse animation: subtle 1.5s ease-in-out infinite between --color-surface and --color-surface-warm
    - Text variant: 0.9em height, --radius-sm, full width
    - Card variant: 120px height, --radius-panel, 2px border
    - Circle variant: 2.5rem diameter, --radius-circle
    - All values reference tokens.css custom properties
  - src/renderer/components/ui.ts -- barrel export updated with UModal, UConfirmModal, USkeleton
  - Build and typecheck pass

p1-07: Create ULogViewer component with virtualization   [DONE]
  - Installed react-window@2 as production dependency (v2 ships bundled types, no @types needed)
  - src/renderer/components/ui/RingBuffer.ts
    - Generic circular fixed-capacity array for log line storage
    - Default capacity 5 000 lines, configurable via constructor
    - Circular array with head pointer and count tracking
    - push() O(1): appends item, overwrites oldest when full
    - get(index) O(1): retrieves item at logical index (0 = oldest)
    - toArray() O(n): returns all items in insertion order
    - clear(): resets buffer to empty state
    - Exports RingBuffer class
  - src/renderer/components/ui/ULogViewer.tsx
    - Virtualized log viewer using react-window v2 List component
    - rowHeight 20px (IBM Plex Mono line height), overscanCount 20
    - Accepts external lines[] prop or uses internal RingBuffer via imperative handle
    - Auto-scroll to bottom (toggleable): tracks visible rows via onRowsRendered
    - Disables auto-scroll when user scrolls up, re-enables on button click
    - Line numbers: 1-based, right-aligned, non-selectable
    - ANSI color support: strips ANSI escape codes via regex (\x1b\[[0-9;]*[A-Za-z])
    - Search/filter input: case-insensitive substring match, shows match count
    - Expand-to-fullscreen toggle: fixed position overlay with z-index 9999
    - Copy-all button: copies all visible (filtered) lines to clipboard via navigator.clipboard
    - Scroll-to-bottom indicator button when auto-scroll is off
    - Footer status bar showing line count and capacity
    - ULogViewerHandle interface for imperative push/pushMany/clear/copyAll/scrollToBottom
    - Exports ULogViewerProps, ULogViewerHandle types
  - src/renderer/components/ui/ULogViewer.module.css
    - Dark terminal theme: --color-log-bg (#111), --color-log-text (#e6e6e6)
    - Toolbar: search input, auto-scroll toggle, copy button, fullscreen toggle
    - Fullscreen mode: position fixed, inset 0, z-index 9999
    - Row hover highlight, search match highlight (accent rgba)
    - Line number column: fixed width, right-aligned, muted color
    - Scroll-to-bottom indicator: absolute positioned pill button
    - All values reference tokens.css custom properties
  - src/renderer/components/ui.ts -- barrel export updated with ULogViewer, ULogViewerHandle, RingBuffer
  - Build and typecheck pass

p1-09: Install react-router-dom and create route structure   [DONE]
  - Installed react-router-dom@7 (v7.13.0) as production dependency
  - src/renderer/router.tsx
    - createHashRouter with createRoutesFromElements (HashRouter required for Electron file://)
    - AppShell layout route wrapping all child routes
    - Routes: / -> PlanListView, /plan/:planId -> PlanDetailView,
      /discovery -> DiscoveryView, /run/:runId -> LiveRunView, /settings -> SettingsView
  - src/renderer/components/AppShell/AppShell.tsx
    - Layout component with sidebar + main content area
    - Sidebar: brand badge, NavLink navigation with active state styling
    - NavLink uses className callback for isActive -> navLinkActive class
    - Renders child routes via <Outlet /> in main content area
    - NAV_ITEMS: Plans (/), Discovery (/discovery), Settings (/settings)
  - src/renderer/components/AppShell/AppShell.module.css
    - CSS grid layout: 220px sidebar + 1fr content
    - Sidebar: flex column, panel background, 2px solid right border
    - NavLink: rounded, hover warm surface, active wizard-green highlight
    - Responsive: collapses to horizontal nav bar below 768px
    - All values reference tokens.css custom properties
  - src/renderer/views/PlanListView.tsx -- stub view for plan list (route: /)
  - src/renderer/views/PlanDetailView.tsx -- stub view with useParams planId (route: /plan/:planId)
  - src/renderer/views/DiscoveryView.tsx -- stub view for discovery interview (route: /discovery)
  - src/renderer/views/LiveRunView.tsx -- stub view with useParams runId (route: /run/:runId)
  - src/renderer/views/SettingsView.tsx -- stub view for settings (route: /settings)
  - src/renderer/index.tsx -- updated to render RouterProvider with hash router instead of App
  - Build and typecheck pass

p1-10: Create Sidebar component with plan list navigation   [DONE]
  - src/renderer/components/layout/Sidebar.tsx
    - Extracted sidebar from AppShell into dedicated Sidebar component
    - NavLink navigation with active state highlighting (Plans, Discovery, Settings)
    - Nav items use icon-letter badges (mono font, bordered square) + labels
    - Collapsible plan list below Plans link, reads from planStore.plansList
    - Plan items link to /plan/:planId with UStatusPill status badges
    - Plan summary truncated to 40 chars with ellipsis
    - Relative timestamps via timeAgo() helper (e.g. "2h ago", "3d ago")
    - Collapsible toggle: chevron button with rotation animation
    - "New Plan" button navigates to plan list view
    - Sidebar collapse/expand: 280px expanded, 60px collapsed
    - Collapsed mode: icon-only nav links, status-dot-only plan items (max 5)
    - Loads plansList on mount via useEffect
    - Exports SidebarProps type
  - src/renderer/components/layout/Sidebar.module.css
    - Brutalist theme: warm panel background, 2px solid borders, bold typography
    - Width transition: 150ms ease-in-out between expanded/collapsed states
    - Brand section: square badge with accent border, bold title
    - Nav links: flex row with icon + label, 2px transparent border for active state
    - Active link: wizard-green background and border highlight
    - Plan section: left border rail, collapsible list with max-height scroll
    - Plan items: summary + meta row (status pill + timestamp)
    - New Plan button: accent background, 2px border, hover translateY micro-interaction
    - Collapse toggle: muted border, rotate-180 icon flip when collapsed
    - Responsive: horizontal layout below 768px, hides plan list and collapse toggle
    - focus-visible outlines on all interactive elements for accessibility
    - All values reference tokens.css custom properties
  - src/renderer/components/AppShell/AppShell.tsx
    - Replaced inline sidebar markup with <Sidebar /> component
    - Removed NavLink, NavItem, cn() helper, NAV_ITEMS (moved to Sidebar)
    - Shell layout changed from CSS grid to flexbox for dynamic sidebar width
  - src/renderer/components/AppShell/AppShell.module.css
    - Simplified: removed all sidebar/nav/brand styles (now in Sidebar.module.css)
    - Layout changed from grid (220px + 1fr) to flex row
    - Content area uses flex: 1 to fill remaining width
    - Responsive: flex-direction column below 768px
  - Build and typecheck pass

p1-11: Implement ErrorBoundary components   [DONE]
  - src/renderer/components/layout/ErrorBoundary.tsx
    - AppErrorBoundary: class component wrapping entire RouterProvider
    - Catches catastrophic errors, shows full-page error card with Restart App button
    - Uses getDerivedStateFromError + componentDidCatch for error capture
    - Logs errors to console with [AppErrorBoundary] prefix
    - Displays error message in styled pre block; shows component stack in dev mode
    - Restart button calls window.location.reload()
    - ViewErrorBoundary: class component wrapping individual route views
    - Catches per-view errors, shows error card with Retry and Go Home buttons
    - Retry resets error state to re-render children
    - Go Home resets error state and calls onNavigateHome callback
    - Logs errors to console with [ViewErrorBoundary] prefix
    - Displays error message and component stack (dev only) in styled pre blocks
    - RouteErrorBoundary: functional wrapper around ViewErrorBoundary
    - Uses useNavigate hook to provide onNavigateHome callback (navigates to "/")
    - Decouples class components from react-router-dom hooks
  - src/renderer/components/layout/ErrorBoundary.module.css
    - AppError: full-viewport centered layout with gradient background
    - ViewError: top-aligned centered layout for in-shell display
    - Error message: mono font, red text on error-bg, 1px border, scrollable
    - Component stack: mono font, muted text, dashed border, scrollable
    - All values reference tokens.css custom properties
  - src/renderer/index.tsx
    - Wrapped <RouterProvider> with <AppErrorBoundary> inside StrictMode
  - src/renderer/router.tsx
    - Wrapped each route element with <RouteErrorBoundary> for per-view error isolation
    - All five routes (/, /plan/:planId, /discovery, /run/:runId, /settings) wrapped
  - Uses UCard and UButton from existing UI primitives for error display
  - Build and typecheck pass

p1-12: Decompose App.tsx into PlanDetailView   [DONE]
  - src/renderer/views/PlanDetailView.tsx
    - Replaced stub with full plan detail view reading planId from useParams()
    - Loads plan from planStore on mount and when planId changes
    - Subscribes to run events via initRunEventSubscription() from runStore
    - Re-loads plan when run completed/failed/cancelled/task_status events arrive
    - Filters recentEvents to current planId for scoped event display
    - Builds latestRunByTask map from plan.runs for TaskCard run association
    - Handles runTask, runAll, cancelRun via window.ralphApi calls
    - Loading state: USkeleton placeholders while plan loads
    - Error state: styled error panel when loadPlan fails
    - Empty states: messages for missing planId or plan not found
    - 12-column CSS grid layout: overview + tech pack (6col each), checklist + live run + events (12col)
    - Responsive: collapses to single-column below 1080px
  - src/renderer/views/PlanDetailView.module.css
    - Grid layout, skeleton stack, error panel, checklist header, live run card, log box, responsive breakpoint
    - All values reference tokens.css custom properties
  - src/renderer/components/plan/PlanOverview.tsx
    - Displays plan summary, UStatusPill for plan status, metadata row (project, tasks, runs, created date)
    - Uses UCard with title and headerAction props
  - src/renderer/components/plan/PlanOverview.module.css
    - Summary paragraph and mono-font meta row styling
  - src/renderer/components/plan/TechnicalPackPanel.tsx
    - Shows architecture notes, risks, dependencies, test strategy in two-column grid
    - Internal Section helper renders title + bulleted list or "No items" placeholder
    - Uses UCard with title prop
  - src/renderer/components/plan/TechnicalPackPanel.module.css
    - Auto-fit grid layout (minmax 210px), section title and list styling
  - src/renderer/components/plan/TaskCard.tsx
    - Self-contained card: task title with ordinal, UStatusPill, collapsible body
    - Chevron toggle with rotation animation; expand/collapse via CSS grid-template-rows transition
    - Body shows: description, meta (ID + dependencies), acceptance criteria list, technical notes
    - Action buttons: "Run Task" and conditional "Open Latest Run"
    - Props: task, latestRun, onRunTask callback, onOpenRun callback
    - Accessible: aria-expanded, aria-label on toggle, focus-visible outlines
  - src/renderer/components/plan/TaskCard.module.css
    - Card border, header flex layout, chevron rotation, collapsible body animation
    - Criteria list, notes, action buttons with brutalist styling
    - focus-visible outlines on toggle and buttons
  - src/renderer/components/plan/RecentEvents.tsx
    - Scrollable list of RunEvents with timestamp formatting (toLocaleTimeString)
    - Each row: formatted timestamp, event type (bold), task ID (truncated)
    - Empty state: "No events yet" message
    - Uses UCard with title prop
  - src/renderer/components/plan/RecentEvents.module.css
    - Three-column grid rows, max-height scroll, dashed border separators
    - Responsive: single-column below 1080px
  - Build and typecheck pass

p1-13: Decompose PromptTemplateBuilder into DiscoveryView   [DONE]
  - src/renderer/stores/discoveryStore.ts
    - Enhanced from minimal store to full discovery state manager
    - State: seedSentence, additionalContext, interview, answerMap, submittedAnswers,
      events, loading, error, thinkingStartedAtMs, lastEventAtMs,
      lastDiscoveryDurationSec, lastReadyAtIso, copyNotice
    - Actions: setSeedSentence, setAdditionalContext, setAnswer, setCopyNotice,
      startDiscovery (validates seed, subscribes to events, tracks timing),
      continueDiscovery (builds answer payload from answerMap, merges new questions),
      reset (cleans up event subscription)
    - Events stored newest-first, capped at 120 entries
    - Timing: tracks thinking start, last event timestamp, cycle duration
    - Exported AnswerMap type alias
  - src/renderer/views/DiscoveryView.tsx
    - Full discovery interview flow (route: /discovery)
    - Reads all state from discoveryStore (no local useState for interview data)
    - Local tickMs timer only for live elapsed display
    - Seed sentence input with UTextArea (auto-resize)
    - Collapsible optional context section
    - AI feedback panel: live events, thinking timer, specialist progress,
      adaptive status text, event log in pre block
    - Discovery output ready card with UStatusPill, "Use as Plan Input" and
      "Copy PRD Input" buttons
    - Discovery status card: round, readiness %, answered count, direction
    - Inferred context card: stack, documentation, scope, pain points,
      constraints, signals
    - Question cards with per-question UTextArea answer inputs
    - Missing critical info warning card
    - Bottom actions: continue discovery, use as plan input, copy PRD
    - PRD preview in collapsible details element
    - "Use as Plan Input" navigates to / with prdText in location state
    - Uses UButton, UTextArea, UStatusPill UI primitives
  - src/renderer/views/DiscoveryView.module.css
    - Vertical sections grid layout with spacing
    - AI feedback card: header with thinking indicator, pulse/dot animations,
      meta row, status text with warning highlight, log box
    - Status card, context card, question cards, missing info card
    - Question list: dashed border items with text + reason + textarea
    - PRD preview toggle and scrollable pre block
    - All values reference tokens.css custom properties
  - src/renderer/components/PromptTemplateBuilder.tsx
    - Reduced to thin deprecated wrapper (~40 lines)
    - Preserves legacy interface (projectPath + onUsePrompt props)
    - Forwards interview.prdInputDraft to onUsePrompt via useEffect
    - Renders placeholder message pointing to /discovery route
    - Marked with @deprecated JSDoc tag
  - Build and typecheck pass

p1-14: Create PlanListView and LiveRunView stubs with real data   [DONE]
  - src/renderer/views/PlanListView.tsx
    - Replaced stub with full plan list view reading from planStore.plansList
    - Loads plansList on mount via loadPlanList action
    - Search input filters plans by summary or project path (case-insensitive)
    - Responsive card grid: auto-fill with minmax(320px, 1fr)
    - Each plan card shows: summary, UStatusPill status, project path (truncated), created date, time ago
    - Cards are clickable (role="button") with keyboard support (Enter/Space), navigate to /plan/:id
    - Loading state: USkeleton placeholders while list loads
    - Error state: styled error panel when loadPlanList fails
    - Empty state: message suggesting Discovery or PRD import
    - No-matches state when search yields zero results, shows match count
    - Helpers: timeAgo(), shortDate(), truncatePath()
  - src/renderer/views/PlanListView.module.css
    - Header with title, search row with mono font input
    - Card grid with auto-fill columns, hover translateY(-2px) micro-interaction
    - Plan card: brutalist panel with 2px border, shadow, cursor pointer
    - Meta row with labeled items (Path, Created, time ago)
    - Skeleton stack, empty state (dashed border), error panel
    - Responsive: single-column below 768px
    - All values reference tokens.css custom properties
  - src/renderer/views/LiveRunView.tsx
    - Replaced stub with full run detail view reading runId from useParams()
    - Subscribes to run events via initRunEventSubscription() from runStore
    - Locates TaskRun record from currentPlan.runs array
    - Re-loads plan when run completed/failed/cancelled events arrive for this runId
    - Run status: prefers live activeRuns state, falls back to TaskRun record
    - Metadata card: status (UStatusPill), run ID, task ID, started/ended timestamps, duration, cost, stop reason
    - Duration formatted as human-readable (ms, s, m s, h m) via formatDuration()
    - Cost formatted as USD with 4 decimal places via formatCostUsd()
    - Todo snapshot panel: list of TodoItem entries with color-coded status badges
    - ULogViewer with full streamed log output (height 500px, auto-scroll when active)
    - Cancel button shown only for active runs (in_progress or queued)
    - Back button navigates to /plan/:planId or / as fallback
    - Result text section: shown when run has resultText
    - Error text section: shown when run has errorText
    - Missing runId state: message directing to plan detail page
  - src/renderer/views/LiveRunView.module.css
    - Header with back button, title, cancel button
    - Metadata card: flex-wrap row of labeled metadata items
    - Cost value highlighted in accent-2 color
    - Two-column content grid: todo panel + log section
    - Todo panel: brutalist card, list with dashed separators, status badges color-coded
    - Log section: full-width spanning both columns
    - Result card: dark terminal theme pre block
    - Error card: red border with error-bg background
    - Responsive: single-column below 900px
    - All values reference tokens.css custom properties
  - Build and typecheck pass

p1-15: Create SettingsView stub   [DONE]
  - src/renderer/views/SettingsView.tsx
    - Replaced stub with full settings view reading from settingsStore
    - Three UCard sections: Model Configuration, Application Preferences, About
    - Model Configuration: read-only table of agent roles (planning, discovery, execution, wizard)
    - Each role row shows: role name, human-readable description, model ID with "(default)" hint
    - MODEL_ROLES ordered list and ROLE_DESCRIPTIONS map for display
    - Loads settings on mount via useSettingsStore.loadSettings()
    - Loading state: USkeleton text placeholder while settings load
    - Error state: styled error panel when loadSettings fails
    - Application Preferences: placeholder text for future theme, notifications, default paths
    - About section: 2-column grid showing App Version, Electron, Node.js, Chromium versions
    - Version info hardcoded (0.1.0, 33.x, 20.x, 130.x) -- IPC exposure deferred to Phase 2
  - src/renderer/views/SettingsView.module.css
    - View layout: padded, max-width constrained, auto-centered
    - Sections stack: flex column with gap spacing
    - Model table: mono font, dashed border rows, uppercase headers, role capitalized
    - Model cell: accent-2 color with italic read-only hint
    - About grid: 2-column auto/1fr layout with sans label + mono value
    - Placeholder text: muted mono font
    - Error panel: red border with error-bg background
    - Responsive: single-column about grid below 768px
    - All values reference tokens.css custom properties
  - Route /settings already wired in router.tsx from p1-09
  - Build and typecheck pass

p1-16: Migrate styles.css to CSS Modules   [DONE]
  - src/renderer/App.module.css (new)
    - Co-located CSS Module for legacy App.tsx component
    - Contains all 30+ class selectors previously in global styles.css
    - Scoped versions: appShell, hero, heroBadge, heroTitle, heroDescription,
      panel, panelHeader, panelHeaderActions, layoutGrid, checklistPanel,
      runPanel, planInput, label, textInput, textArea, actionBtn + variants
      (primary, secondary, ghost, danger), statusPill + status variants
      (statusPending, statusInProgress, statusCompleted, statusFailed,
      statusCancelled), metaRow, twoCol, taskList, taskCard, taskHeader,
      acceptanceList, notes, taskActions, runContent, logBox, eventList,
      errorPanel
    - Responsive media query (max-width 1080px) for layout-grid collapse
  - src/renderer/App.tsx
    - Replaced all global className strings with CSS Module references (styles.*)
    - statusClass() helper now maps status strings to CSS Module class names
      via STATUS_CLASS_MAP lookup object
    - Compound classes use template literal concatenation (e.g. `${styles.panel} ${styles.planInput}`)
    - Import: `import styles from "./App.module.css"`
  - src/renderer/styles.css
    - Trimmed from 537 lines to 44 lines
    - Retained only: Google Fonts @import, tokens.css @import, box-sizing reset,
      body base styles (margin, font-family, color, background gradient),
      heading/paragraph/list margin resets
    - Removed all component classes: app-shell, hero, panel, layout-grid,
      checklist-panel, run-panel, plan-input, template-builder, wizard-*,
      discovery-live-header, thinking-*, suggested-edits, template-*,
      compact-area, checkbox-row, weight-*, advanced-settings, notice-text,
      error-text, warning-text, prompt-preview, label, text-input, text-area,
      action-btn, status-pill, status-*, meta-row, two-col, task-list,
      task-card, task-header, acceptance-list, notes, task-actions,
      run-content, log-box, event-list, error-panel
    - Removed orphan @keyframes: discovery-pulse, thinking-dot
    - Removed orphan @media query (1080px breakpoint)
    - Added header comment documenting the global-only policy
  - No orphan wizard/template/discovery global classes remain (verified via grep)
  - All modern views/components (P1-04 through P1-15) already use CSS Modules
  - Build and typecheck pass

p1-17: Fix bug: Remove hardcoded 'dotnet build' from task execution prompt   [DONE]
  - src/main/runtime/ralph-agent-service.ts
    - runTask() method: taskPrompt template literal, step 4 of "Strict workflow"
    - Removed hardcoded "Run dotnet build and required tests from PRD."
    - Replaced with generic: "Run build and required tests. Use the project's build
      and test commands as detected from project configuration files (package.json,
      Cargo.toml, Makefile, etc.) or as specified in the plan's technical notes."
    - No other dotnet references found in the file
  - Build and typecheck pass

p1-18: Fix bug: taskRunMap shows latest run per task   [DONE]
  - src/renderer/App.tsx
    - taskRunMap(): added explicit sort by startedAt DESC before first-match loop
    - Previously relied on implicit DB ordering (plan.runs from getPlan)
    - Now copies array with spread, sorts newest-first, then picks first per taskId
    - Added JSDoc comment documenting the sorting guarantee
  - src/renderer/views/PlanDetailView.tsx
    - buildTaskRunMap(): same explicit sort by startedAt DESC added
    - Updated JSDoc: removed "runs are ordered newest-first from the backend" assumption
    - Now self-contained: correct regardless of input array ordering
  - src/main/runtime/app-database.ts
    - getPlan() already had ORDER BY started_at DESC on runs query (no change needed)
    - DB ordering is now a performance optimization, not a correctness requirement
  - Build and typecheck pass

p1-19: Fix bug: getPlan surfaces JSON parse errors   [DONE]
  - src/main/runtime/app-database.ts
    - PlanParseError class (new export): custom Error subclass with field, entityId, cause
    - Message format: "Failed to parse ${field} for plan ${entityId}: ${causeMsg}"
    - getPlan(): technical_pack_json catch block now logs error and throws PlanParseError
      instead of silently returning null
    - parseJsonArray(): signature extended with (field, entityId) context params
    - parseJsonArray(): catch block now logs with [AppDatabase] prefix and throws PlanParseError
      instead of silently returning []
    - All parseJsonArray call sites updated in getPlan(), getTask(), getTasks()
      to pass field name and entity (task) ID for diagnostic context
    - Callers (ipc.ts, planStore.ts, task-runner.ts) already have try/catch
      that surface thrown errors properly
  - Build and typecheck pass

p1-20: Fix bug: titleBarStyle for Windows   [DONE]
  - src/main/index.ts
    - createWindow(): added const isMac = process.platform === "darwin"
    - titleBarStyle: isMac ? "hiddenInset" : "hidden" (was hardcoded "hiddenInset")
    - Windows: spreads titleBarOverlay config { color: "#1a1a1a", symbolColor: "#e0e0e0", height: 36 }
    - macOS: no titleBarOverlay (empty spread)
    - "hiddenInset" is macOS-only; caused rendering issues on Windows
  - src/renderer/components/AppShell/AppShell.tsx
    - Added drag-region strip div at top of content area (36px height)
    - Wrapped Outlet in contentInner div to preserve padding
    - Updated JSDoc with drag-region documentation
  - src/renderer/components/AppShell/AppShell.module.css
    - .dragStrip: -webkit-app-region: drag, height 36px, flex-shrink 0
    - .content: changed to flex column layout to accommodate drag strip
    - .contentInner: new class with original padding (var(--space-xl))
  - src/renderer/components/layout/Sidebar.module.css
    - .brand: added -webkit-app-region: drag (sidebar header is draggable)
    - .navLink, .planToggle, .planItem, .newPlanBtn, .collapseBtn: added
      -webkit-app-region: no-drag so interactive elements remain clickable
  - Build and typecheck pass

p1-21: Fix bug: Deduplicate IPC_CHANNELS in preload   [DONE]
  - src/preload/index.ts
    - Removed local IPC_CHANNELS object (14 lines) that redeclared all 11 channel name strings
    - Added import: `import { IPC_CHANNELS } from "@shared/ipc"`
    - Single source of truth: all three contexts (main, preload, renderer) now
      reference the same IPC_CHANNELS export from src/shared/ipc.ts
    - @shared alias resolves correctly in preload CJS build (confirmed by electron-vite
      bundling 2 modules into out/preload/index.js)
  - No other files changed; all IPC_CHANNELS usages in preload already used
    property access (IPC_CHANNELS.createPlan, etc.) so they work unchanged
  - Build and typecheck pass

p2-01: Add archived_at column and plan management DB methods   [DONE]
  - resources/migrations/002_plan_archive.sql
    - ALTER TABLE plans ADD COLUMN archived_at TEXT (nullable, null = not archived)
  - src/shared/types.ts
    - RalphPlan: added archivedAt: string | null field
    - PlanListItem interface (new): id, summary, status, projectPath, createdAt, archivedAt
    - ListPlansFilter interface (new): archived?: boolean, search?: string
    - ListPlansInput, DeletePlanInput, ArchivePlanInput, UnarchivePlanInput interfaces (new)
    - RalphApi: added listPlans, deletePlan, archivePlan, unarchivePlan methods
  - src/shared/ipc.ts
    - IPC_CHANNELS: added listPlans, deletePlan, archivePlan, unarchivePlan channel names
    - Zod schemas: listPlansInputSchema, deletePlanInputSchema, archivePlanInputSchema, unarchivePlanInputSchema
  - src/main/runtime/app-database.ts
    - PlanRow: added archived_at field; PlanListRow interface (new)
    - getPlan(): now returns archivedAt from plan row
    - listPlans(filter?): SELECT with dynamic WHERE conditions (archived, search), ORDER BY created_at DESC
    - deletePlan(planId): DELETE FROM plans (CASCADE handles tasks/runs/events/snapshots)
    - archivePlan(planId): UPDATE archived_at to ISO timestamp
    - unarchivePlan(planId): UPDATE archived_at to NULL
  - src/main/runtime/task-runner.ts
    - Pass-through methods: listPlans, deletePlan, archivePlan, unarchivePlan
  - src/main/ipc.ts
    - Registered IPC handlers for plan:list, plan:delete, plan:archive, plan:unarchive
  - src/preload/index.ts
    - Bridge methods: listPlans, deletePlan, archivePlan, unarchivePlan
  - src/renderer/stores/planStore.ts
    - PlanSummary: added archivedAt field
    - loadPlanList(): wired to real IPC, accepts filter param
    - deletePlan(): wired to real IPC, then removes from local list
    - archivePlan(): wired to real IPC, updates local archivedAt
    - unarchivePlan() (new): wired to real IPC, clears local archivedAt
  - Build and typecheck pass

p2-02: Add plan management IPC channels   [DONE]
  - All artifacts were already implemented as part of p2-01; this entry confirms
    completeness against the p2-02 task description and records verification.
  - src/shared/ipc.ts
    - IPC_CHANNELS: listPlans ("plan:list"), deletePlan ("plan:delete"),
      archivePlan ("plan:archive"), unarchivePlan ("plan:unarchive")
    - Zod schemas: listPlansInputSchema (filter?: { archived?, search? }),
      deletePlanInputSchema ({ planId: uuid }), archivePlanInputSchema ({ planId: uuid }),
      unarchivePlanInputSchema ({ planId: uuid })
  - src/shared/types.ts
    - TypeScript interfaces: ListPlansInput, DeletePlanInput, ArchivePlanInput, UnarchivePlanInput
    - PlanListItem, ListPlansFilter supporting types
    - RalphApi: listPlans, deletePlan, archivePlan, unarchivePlan methods
  - src/main/ipc.ts
    - ipcMain.handle for plan:list, plan:delete, plan:archive, plan:unarchive
    - Each handler validates raw input with corresponding Zod schema, delegates to TaskRunner
  - src/main/runtime/task-runner.ts
    - Pass-through methods: listPlans, deletePlan, archivePlan, unarchivePlan -> AppDatabase
  - src/main/runtime/app-database.ts
    - listPlans(filter?): dynamic WHERE (archived, search), ORDER BY created_at DESC
    - deletePlan(planId): DELETE with CASCADE
    - archivePlan(planId): SET archived_at to ISO timestamp
    - unarchivePlan(planId): SET archived_at to NULL
  - src/preload/index.ts
    - Bridge methods: listPlans, deletePlan, archivePlan, unarchivePlan via ipcRenderer.invoke
  - src/renderer/stores/planStore.ts
    - loadPlanList(filter?), deletePlan(planId), archivePlan(planId), unarchivePlan(planId)
      all wired to real IPC through window.ralphApi
  - Build and typecheck pass

p2-03: Implement PlanListView with full plan management   [DONE]
  - src/renderer/views/PlanListView.tsx
    - Debounced search input (300ms) using useRef timer, filters by summary or project path
    - Archive toggle button: toggles showArchived state, re-fetches via loadPlanList({ archived })
    - Plan cards with UStatusPill status badges, project path, created date, and timeAgo
    - Archived plans: dashed border card style, reduced opacity, "Archived" badge next to status pill
    - Click-to-navigate: cards are role="button" with Enter/Space keyboard support -> /plan/:planId
    - Per-card action buttons: Archive/Unarchive and Delete with stopPropagation to avoid navigation
    - UConfirmModal confirmation dialogs for all destructive actions
    - Delete confirmation text: "This will permanently delete the plan and all associated tasks, runs, and logs. This cannot be undone."
    - Archive confirmation: lighter text mentioning plans are hidden but restorable
    - Unarchive confirmation: lighter text mentioning plan returns to main list
    - Loading state with actionLoading flag during confirm operations
    - Empty states: "No plans yet" (default), "No archived plans" (archive mode), "No matching plans" (search)
    - Match count indicator shown when search is active
    - Uses planStore.loadPlanList, deletePlan, archivePlan, unarchivePlan actions (wired in p2-01)
  - src/renderer/views/PlanListView.module.css
    - Controls row: flex layout with search input + archive toggle button
    - Archive toggle: brutalist button with active state (accent-2 background, white text)
    - Plan card actions: dashed border-top separator, small action buttons
    - Danger button variant: red border/text, red background on hover
    - Archived card state: dashed border, 0.7 opacity
    - Archived badge: mono font, uppercase, muted border pill
    - Status row: flex container for status pill + archived badge
    - Responsive: controls row stacks vertically below 768px
    - All values reference tokens.css custom properties
  - planStore already had all needed actions (loadPlanList, deletePlan, archivePlan, unarchivePlan)
    fully wired to real IPC from p2-01/p2-02 -- no store changes needed
  - Build and typecheck pass

p2-04: Add model configuration DB table and migration   [DONE]
  - resources/migrations/004_model_config.sql
    - CREATE TABLE model_config: id TEXT PK, agent_role TEXT UNIQUE NOT NULL,
      model_id TEXT NOT NULL, updated_at TEXT NOT NULL
    - INSERT OR IGNORE seed data (idempotent):
      discovery_specialist -> claude-sonnet-4-20250514
      plan_synthesis       -> claude-sonnet-4-20250514
      task_execution       -> claude-opus-4-20250514
    - Migration numbering (004) accounts for 003 being discovery_sessions
  - src/main/runtime/app-database.ts
    - AgentRole type: "discovery_specialist" | "plan_synthesis" | "task_execution"
    - ModelConfigRow interface (raw DB row shape)
    - ModelConfigEntry interface (camelCase application shape)
    - getModelConfig(): returns all rows from model_config, ordered by agent_role ASC
    - updateModelForRole(role, modelId): updates model_id + updated_at for a given role,
      throws if role does not exist (changes === 0 guard)
  - Build and typecheck pass

p2-05: Add model config IPC and Settings UI   [DONE]
  - src/shared/ipc.ts
    - IPC_CHANNELS: added getModelConfig ("config:getModels"), updateModelConfig ("config:updateModel")
    - updateModelConfigInputSchema: Zod schema with agentRole enum and modelId string
  - src/shared/types.ts
    - AgentRole type: "discovery_specialist" | "plan_synthesis" | "task_execution"
    - ModelConfigEntry interface: id, agentRole, modelId, updatedAt
    - UpdateModelConfigInput interface: agentRole, modelId
    - RalphApi: added getModelConfig() and updateModelConfig() methods
  - src/main/ipc.ts
    - Registered ipcMain.handle for config:getModels (delegates to taskRunner.getModelConfig)
    - Registered ipcMain.handle for config:updateModel (validates with Zod, delegates to taskRunner.updateModelForRole)
  - src/main/runtime/task-runner.ts
    - getModelConfig(): pass-through to AppDatabase.getModelConfig()
    - updateModelForRole(role, modelId): pass-through to AppDatabase.updateModelForRole()
    - Imports AgentRole and ModelConfigEntry from @shared/types
  - src/preload/index.ts
    - getModelConfig(): bridge method via ipcRenderer.invoke(config:getModels)
    - updateModelConfig(input): bridge method via ipcRenderer.invoke(config:updateModel, input)
    - Imports ModelConfigEntry and UpdateModelConfigInput from @shared/types
  - src/renderer/stores/settingsStore.ts
    - Replaced stub ModelRole with re-exported AgentRole from @shared/types
    - AVAILABLE_MODELS constant: Claude Opus 4 (claude-opus-4-20250514), Claude Sonnet 4 (claude-sonnet-4-20250514)
    - modelConfig state: Record<AgentRole, ModelConfigEntry | undefined>, keyed by DB agent_role
    - loadSettings(): calls window.ralphApi.getModelConfig(), populates config map from entries
    - updateModelForRole(role, modelId): calls window.ralphApi.updateModelConfig(), optimistic local update
  - src/renderer/views/SettingsView.tsx
    - AGENT_ROLES: ordered list of 3 DB agent roles for display
    - ROLE_LABELS: human-readable names (Discovery Specialist, Plan Synthesis, Task Execution)
    - ROLE_DESCRIPTIONS: descriptions for each role
    - Model table: replaced read-only text + "(default)" hint with <select> dropdown per role
    - handleModelChange: saves on change via updateModelForRole (no separate save button)
    - Select uses AVAILABLE_MODELS for options, aria-label for accessibility
  - src/renderer/views/SettingsView.module.css
    - Removed .readOnlyHint class (no longer needed)
    - .modelSelect: custom-styled select with appearance:none, 2px brutalist border, SVG arrow indicator
    - Hover: accent-2 border color, focus-visible: 2px accent-2 outline with offset
    - Responsive: max-width 100% on mobile
  - Build and typecheck pass

p2-06: Integrate model config into Agent SDK calls   [DONE]
  - src/main/runtime/ralph-agent-service.ts
    - ModelConfigMap type export: Map<AgentRole, string> mapping roles to model IDs
    - Constructor: accepts optional ModelConfigMap, defaults to empty Map
    - getModel(role) private helper: resolves model ID for a given AgentRole, returns
      undefined when no config exists (SDK falls back to its default)
    - Discovery specialist queries (runDiscoveryPrompt synthesis, runSpecialistAnalysis):
      pass model from getModel("discovery_specialist") to query() options
    - Plan synthesis queries (createPlan, getWizardGuidance, inferStack):
      pass model from getModel("plan_synthesis") to query() options
    - Task execution queries (runTask /clear and main task prompt):
      pass model from getModel("task_execution") to query() options
    - taskModel variable extracted in runTask() to share model across both query() calls
  - src/main/runtime/task-runner.ts
    - Import ModelConfigMap type from ralph-agent-service
    - buildModelConfigMap() private method: reads db.getModelConfig() entries and builds
      a Map<AgentRole, string> for RalphAgentService constructor
    - Constructor: initializes agentService with buildModelConfigMap() instead of bare new
    - refreshModelConfig() method: rebuilds RalphAgentService with fresh DB config,
      replaces agentService reference via controlled type cast
    - updateModelForRole(): now calls refreshModelConfig() after DB write so subsequent
      SDK calls use the updated model immediately
  - Build and typecheck pass

p2-07: Add discovery_sessions table and persistence   [DONE]
  - resources/migrations/003_discovery_sessions.sql
    - CREATE TABLE discovery_sessions: id TEXT PK, project_path TEXT NOT NULL,
      seed_sentence TEXT NOT NULL, additional_context TEXT NOT NULL DEFAULT '',
      answer_history_json TEXT NOT NULL DEFAULT '[]', round_number INTEGER NOT NULL DEFAULT 1,
      latest_state_json TEXT NOT NULL, status TEXT NOT NULL DEFAULT 'active',
      created_at TEXT NOT NULL, updated_at TEXT NOT NULL
    - Indexes: idx_discovery_sessions_status (status), idx_discovery_sessions_project (project_path)
  - src/shared/types.ts
    - DiscoverySessionStatus type: "active" | "completed" | "abandoned"
    - DiscoverySession interface: id, projectPath, seedSentence, additionalContext,
      answerHistory (DiscoveryAnswer[]), roundNumber, latestState (DiscoveryInterviewState),
      status, createdAt, updatedAt
  - src/main/runtime/app-database.ts
    - DiscoverySessionRow interface (raw DB row shape)
    - CreateDiscoverySessionInput interface: id, projectPath, seedSentence, additionalContext, latestState
    - UpdateDiscoverySessionInput interface: id, answerHistory?, roundNumber?, latestState?, status?
    - createDiscoverySession(): inserts new session with empty answer history and round 1, returns DiscoverySession
    - updateDiscoverySession(): dynamic SET clause updates only provided fields plus updated_at
    - getActiveDiscoverySessions(): returns all sessions with status 'active', ordered by updated_at DESC
    - getDiscoverySession(id): returns single session by ID or null
    - abandonDiscoverySession(id): sets status to 'abandoned' and updates updated_at
    - mapDiscoverySessionRow() private helper: parses answer_history_json and latest_state_json,
      throws PlanParseError on corrupt latest_state_json
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p2-08: Add discovery session IPC and resume flow   [DONE]
  - src/shared/ipc.ts
    - IPC_CHANNELS: added discoverySessions ("discovery:sessions"),
      discoveryResume ("discovery:resume"), discoveryAbandon ("discovery:abandon")
    - Zod schemas: discoveryResumeInputSchema ({ sessionId: uuid }),
      discoveryAbandonInputSchema ({ sessionId: uuid })
  - src/shared/types.ts
    - DiscoverySessionSummary interface: id, projectPath, seedSentence,
      roundNumber, readinessScore, updatedAt
    - ResumeDiscoveryInput interface: sessionId
    - AbandonDiscoveryInput interface: sessionId
    - RalphApi: added getDiscoverySessions(), resumeDiscoverySession(),
      abandonDiscoverySession() methods
  - src/main/ipc.ts
    - Registered ipcMain.handle for discovery:sessions (lists active sessions),
      discovery:resume (resumes by ID), discovery:abandon (abandons by ID)
    - Each handler validates with Zod schema, delegates to TaskRunner
  - src/main/runtime/task-runner.ts
    - startDiscovery(): now persists session to DB via db.createDiscoverySession()
      after initial round completes
    - continueDiscovery(): now persists updated session state via
      db.updateDiscoverySession() after each round (answerHistory, roundNumber, latestState)
    - getActiveDiscoverySessions(): returns lightweight summaries from DB active sessions
    - resumeDiscoverySession(sessionId): loads session from DB, validates active status,
      hydrates in-memory DiscoverySession map, returns latestState for UI restoration
    - abandonDiscoverySession(sessionId): removes from in-memory map, marks abandoned in DB
  - src/preload/index.ts
    - Bridge methods: getDiscoverySessions(), resumeDiscoverySession(),
      abandonDiscoverySession() via ipcRenderer.invoke
  - src/renderer/stores/discoveryStore.ts
    - New state: activeSessions (DiscoverySessionSummary[]), checkingSessions (boolean)
    - checkActiveSessions(): fetches active sessions from backend, populates activeSessions
    - resumeSession(sessionId): calls resumeDiscoverySession IPC, hydrates store from
      returned latestState, builds answerMap from questions, clears activeSessions
    - abandonSession(sessionId): calls abandonDiscoverySession IPC, removes from local list
  - src/renderer/views/DiscoveryView.tsx
    - On mount: calls checkActiveSessions() if no interview is loaded
    - Resume dialog: shown when activeSessions exist and no interview/loading active
    - Dialog lists each active session with seed sentence (truncated), round number,
      readiness score, project path, updated timestamp
    - "Resume" button per session hydrates store from persisted state
    - "Start Fresh (abandon all)" button abandons all active sessions and closes dialog
  - src/renderer/views/DiscoveryView.module.css
    - Resume overlay: fixed position, centered, semi-transparent backdrop
    - Resume dialog: brutalist panel with 2px border, shadow, max-width 520px
    - Session items: dashed border, flex layout with info + resume button
    - Session meta: mono font, muted color, flex-wrap row
    - Dialog footer: dashed border-top separator, right-aligned ghost button
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-01: Add retry/skip/abort controls for failed tasks   [DONE]
  - resources/migrations/005_run_retry.sql
    - ALTER TABLE runs ADD COLUMN retry_count INTEGER NOT NULL DEFAULT 0
  - src/shared/types.ts
    - TaskStatus: added "skipped" to union type
    - TaskRun: added retryCount: number field
    - RetryTaskInput, RetryTaskResponse, SkipTaskInput, AbortQueueInput interfaces (new)
    - RalphApi: added retryTask, skipTask, abortQueue methods
  - src/shared/ipc.ts
    - IPC_CHANNELS: added retryTask ("task:retry"), skipTask ("task:skip"), abortQueue ("queue:abort")
    - Zod schemas: retryTaskInputSchema, skipTaskInputSchema, abortQueueInputSchema
  - src/main/runtime/app-database.ts
    - RunRow: added retry_count field
    - CreateRunInput: added optional retryCount field
    - createRun(): writes retry_count column (defaults to 0)
    - getPlan(), getRun(): maps retry_count to retryCount in TaskRun
    - getLatestFailedRun(planId, taskId): new method, returns most recent failed run for retry context
    - countRunnableTasks(), findNextRunnableTask(): treat "skipped" as satisfied dependency (alongside "completed")
  - src/main/runtime/ralph-agent-service.ts
    - RetryContext interface (new): retryCount, previousError
    - RunTaskArgs: added optional retryContext field
    - runTask(): injects retry error context into task prompt when retryContext is provided
    - Prompt injection: "IMPORTANT: A previous attempt at this task failed with the following error:
      [error]. Please analyze this failure and take a different approach to avoid the same issue."
  - src/main/runtime/task-runner.ts
    - MAX_RETRIES constant: 3 (configurable)
    - abortedPlanQueues Set: tracks plans with aborted queue execution
    - retryTask(input): validates failed status, checks retry limit, creates new run with
      retry_count incremented, injects previous error into agent prompt via retryContext
    - skipTask(input): validates failed status, marks task as "skipped", updates plan status
      (completed if all tasks done/skipped, else ready)
    - abortQueue(input): signals queue loop to stop via abortedPlanQueues Set, cancels any
      active run for the plan, updates plan status to "ready"
    - executeQueue(): checks abortedPlanQueues before each iteration, cleans up in finally block
    - executeRun(): accepts optional retryContext, passes it through to agentService.runTask()
  - src/main/ipc.ts
    - Registered ipcMain.handle for task:retry, task:skip, queue:abort
    - Each handler validates with Zod schema, delegates to TaskRunner
  - src/preload/index.ts
    - Bridge methods: retryTask, skipTask, abortQueue via ipcRenderer.invoke
  - src/renderer/components/UStatusPill/UStatusPill.tsx
    - STATUS_COLOR_MAP: added skipped -> #9333ea (purple)
    - STATUS_BG_MAP: added skipped -> #f3e8ff (light purple)
  - src/renderer/components/plan/TaskCard.tsx
    - TaskCardProps: added onRetryTask, onSkipTask, onAbortQueue callbacks and queueRunning flag
    - Actions section: when task.status is "failed", shows Retry (primary), Skip (ghost),
      and Abort Queue (danger, only when queueRunning) buttons instead of "Run Task"
  - src/renderer/components/plan/TaskCard.module.css
    - .btnDanger: red border/text, red background on hover for abort/danger actions
  - src/renderer/views/PlanDetailView.tsx
    - handleRetryTask: calls retryTask IPC, selects the new run
    - handleSkipTask: calls skipTask IPC, reloads plan
    - handleAbortQueue: calls abortQueue IPC, reloads plan
    - TaskCard instances: pass onRetryTask, onSkipTask, onAbortQueue, queueRunning props
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-02: Add cancel improvements with timeout and cleanup   [DONE]
  - src/main/runtime/task-runner.ts
    - CANCEL_TIMEOUT_MS constant: 10_000 (10 seconds default)
    - STALE_RUN_THRESHOLD_MS constant: 3_600_000 (1 hour)
    - cancelRun(): refactored to use Promise.race between SDK interrupt and timeout
    - If interrupt resolves first, normal cancel flow proceeds
    - If timeout fires first, calls forceCancelRun() for direct DB update
    - If no interrupt handle exists, force-cancels immediately
    - forceCancelRun(runId) private method: updates run status to 'cancelled',
      sets ended_at to now, error_text to 'Cancelled (forced after timeout)',
      resets task status to 'pending', plan status to 'ready',
      emits cancelled event, cleans up activeRuns and runCompletion maps
    - cleanupStaleRuns() private method: runs once in constructor,
      finds in_progress runs older than STALE_RUN_THRESHOLD_MS via
      db.getStaleInProgressRuns(), marks them cancelled with explanatory error,
      resets associated task/plan statuses, logs cleanup count
  - src/main/runtime/app-database.ts
    - getStaleInProgressRuns(olderThan): returns TaskRun[] for runs with
      status 'in_progress' and started_at < olderThan threshold (ISO string),
      ordered by started_at ASC
  - src/renderer/stores/runStore.ts
    - CANCEL_TIMEOUT_MS constant: mirrors backend timeout for UI progress
    - cancelRequestedAt state: Record<string, number> tracking cancel start timestamps
    - cancelRun(): immediately transitions activeRuns[runId] to 'cancelling',
      records cancelRequestedAt timestamp, awaits backend cancelRun IPC,
      transitions to 'cancelled' if event stream hasn't already done so,
      cleans up cancelRequestedAt on completion
    - getCancelTimeoutMs(): returns the timeout constant for UI display
    - _handleRunEvent(): clears cancelRequestedAt on terminal events
      (completed, failed, cancelled)
  - src/renderer/components/UStatusPill/UStatusPill.tsx
    - STATUS_COLOR_MAP: added cancelling -> #d97706 (amber)
    - STATUS_BG_MAP: added cancelling -> #fde68a (light amber)
  - src/renderer/views/LiveRunView.tsx
    - Added useState import for cancelElapsedMs timer
    - Reads cancelRequestedAt and getCancelTimeoutMs from runStore
    - isCancelling derived state: true when runStatus is 'cancelling'
    - Cancel progress timer: useEffect with 200ms interval updates cancelElapsedMs
      from cancelStartMs, capped at cancelTimeoutMs
    - cancelProgressPct: percentage (0-100) for progress bar width
    - Header: replaces "Cancel Run" button with cancelling UI group when active:
      "Cancelling..." label, progress bar track with animated fill bar,
      countdown text showing remaining seconds
  - src/renderer/views/LiveRunView.module.css
    - .cancellingGroup: flex row with gap for label + progress + countdown
    - .cancellingLabel: amber bold text
    - .cancelProgressTrack: 100px wide, 6px height, bordered track
    - .cancelProgressBar: amber fill with 200ms linear width transition
    - .cancelProgressText: mono font countdown, right-aligned
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-03: Add discovery abort/cancellation support   [DONE]
  - src/shared/ipc.ts
    - IPC_CHANNELS: added discoveryCancel ("discovery:cancel")
    - discoveryCancelInputSchema: Zod schema with sessionId (uuid)
  - src/shared/types.ts
    - CancelDiscoveryInput interface: sessionId
    - CancelDiscoveryResponse interface: ok (boolean)
    - RalphApi: added cancelDiscovery() method
  - src/main/runtime/task-runner.ts
    - cancelledDiscoveries Set: tracks session IDs flagged for cancellation
    - cancelDiscovery(input): sets cancelled flag, emits "failed" discovery event
      with "Discovery cancelled by user." message, returns { ok: true }
    - checkDiscoveryCancelled(sessionId) private method: checks cancelled flag,
      cleans up in-memory session, throws cancellation Error to abort discovery flow
    - startDiscovery(): calls checkDiscoveryCancelled after agentService.startDiscovery
      resolves; catch block skips duplicate failure event if already cancelled
    - continueDiscovery(): calls checkDiscoveryCancelled after agentService.continueDiscovery
      resolves; catch block skips duplicate failure event if already cancelled
    - Uses flag-based cancellation: if specialist query is mid-flight it may complete
      but result is discarded when cancellation check runs after Promise.allSettled
  - src/main/ipc.ts
    - Registered ipcMain.handle for discovery:cancel, validates with Zod,
      delegates to taskRunner.cancelDiscovery()
  - src/preload/index.ts
    - Bridge method: cancelDiscovery(input) via ipcRenderer.invoke(discovery:cancel)
  - src/renderer/stores/discoveryStore.ts
    - cancelDiscovery action: calls backend cancelDiscovery IPC, unsubscribes from
      discovery events, resets loading state, sets error to "Discovery cancelled."
  - src/renderer/views/DiscoveryView.tsx
    - Wires cancelDiscovery action from discoveryStore
    - handleCancelDiscovery handler invokes cancelDiscovery
    - AI Feedback panel: wraps thinking indicator and new "Cancel Discovery" button
      in feedbackHeaderActions container; button shown only when loading is true
    - Cancel button uses UButton variant="danger" size="sm"
  - src/renderer/views/DiscoveryView.module.css
    - .feedbackHeaderActions: flex row with gap for thinking indicator + cancel button
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-04: Install and configure toast notification system   [DONE]
  - Installed react-hot-toast as production dependency
  - src/renderer/services/toastService.ts (new)
    - Typed wrapper module around react-hot-toast
    - Exported methods: success(msg), error(msg), info(msg), warning(msg)
    - Each method returns toast ID string for programmatic dismissal
    - success: green accent icon, 4s duration
    - error: red accent icon, 6s duration
    - info: info emoji icon, 4s duration
    - warning: warning emoji icon, 5s duration
    - Namespace export: toastService object for convenient import
  - src/renderer/components/AppShell/AppShell.tsx
    - Added react-hot-toast Toaster provider, position: "bottom-right"
    - Brutalist toast styling: dark background (#1a1a1a), warm border (#d97706),
      Space Grotesk font, bold weight, hard shadow (4px 4px 0 #000), 8px radius
    - Success variant: green border (#15803d)
    - Error variant: red border (#b91c1c), 6s duration
    - Max width 420px, padded 12px 16px
  - src/renderer/stores/planStore.ts
    - createPlan: success toast "Plan created successfully." on success,
      error toast with message on failure
    - deletePlan: success toast "Plan deleted." on success,
      error toast on failure
    - archivePlan: success toast "Plan archived." on success,
      error toast on failure
    - unarchivePlan: success toast "Plan restored from archive." on success,
      error toast on failure
  - src/renderer/stores/runStore.ts
    - _handleRunEvent "completed": success toast "Task completed: {taskId}"
    - _handleRunEvent "failed": error toast "Task failed: {taskId}"
    - _handleRunEvent "cancelled": info toast "Run cancelled."
  - src/renderer/stores/discoveryStore.ts
    - startDiscovery success: success toast "Discovery completed. PRD input is ready."
    - startDiscovery failure: error toast with error message
    - continueDiscovery success: success toast "Discovery updated. PRD input refreshed."
    - continueDiscovery failure: error toast with error message
  - src/renderer/views/DiscoveryView.tsx
    - handleCopyPrdInput: success toast on clipboard copy, warning toast if API
      unavailable, error toast on failure
  - src/renderer/components/ui/ULogViewer.tsx
    - copyAll: success toast "Logs copied to clipboard." after copy
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-05: Add loading skeletons and streaming progress indicators   [DONE]
  - src/renderer/views/PlanListView.tsx
    - Enhanced skeleton loading state: 4 skeleton cards matching plan card layout
    - Each skeleton card: header row (title line + status pill placeholder),
      2-line text skeleton, meta row with path and date placeholders
    - Integrated PlanCreationProgress panel for plan creation from Discovery
    - Reads location.state.prdText from Discovery "Use as Plan Input" navigation
    - Auto-triggers createPlan on arrival, navigates to /plan/:id on success
    - Shows PlanCreationProgress component during creation with error fallback
    - Added useLocation import, creating/createPlan store selectors, creationError state
  - src/renderer/views/PlanListView.module.css
    - .skeletonCard: flex column container matching planCard padding and border
    - .skeletonCardHeader: flex row for title + pill alignment
    - .skeletonCardMeta: flex row for path + date spacing
  - src/renderer/views/PlanDetailView.tsx
    - Enhanced skeleton loading state: full 12-col grid layout matching main render
    - Overview skeleton (spanHalf): panel header row, 3-line text, meta row
    - Technical pack skeleton (spanHalf): title line, 2-col grid with section skeletons
    - Checklist skeleton (spanFull): title line + 3 card skeletons
    - Replaced flat skeletonStack with structured grid matching actual content layout
  - src/renderer/views/PlanDetailView.module.css
    - .skeletonPanel: flex column with padding, soft border, panel background
    - .skeletonPanelHeader: flex row for title + status alignment
    - .skeletonMetaRow: flex-wrap row for metadata spacing
    - .skeletonTwoCol: 2-column grid for tech pack section pairs
  - src/renderer/views/DiscoveryView.tsx
    - Added USkeleton import for discovery skeleton placeholders
    - Discovery skeleton: shown when loading && !interview && events.length === 0
    - Skeleton layout: header row, 2-line text, 3-column specialist analysis cards
    - Each skeleton card: title line + multi-line text placeholder
    - Notice text: "Specialist agents are analyzing the project..."
    - Enhanced specialistProgress memo: now tracks startedNames and completedNames arrays
    - Specialist tracker panel: shown when specialistProgress.started > 0
    - Individual specialist pills: name, running/done status, color-coded dot
    - Running specialists: amber border + background, pulsing dot animation
    - Completed specialists: green border + background, solid dot
  - src/renderer/views/DiscoveryView.module.css
    - .discoverySkeleton: flex column container with soft border, panel background
    - .discoverySkeletonHeader: flex row for header alignment
    - .discoverySkeletonCards: auto-fit grid for specialist card placeholders
    - .discoverySkeletonCard: dashed border card with gap spacing
    - .discoverySkeletonNotice: muted italic font for loading message
    - .specialistTracker: flex-wrap row for specialist progress pills
    - .specialistItem: pill container with border, mono font, transition
    - .specialistDone: green border + completed background color
    - .specialistRunning: amber border + in-progress background color
    - .specialistDot: 6px dot with color and pulse animation for running state
    - .specialistName: bold, truncated with ellipsis at 140px
    - .specialistStatus: uppercase muted status label
    - @keyframes specialistPulse: opacity animation for running dots
  - src/renderer/components/plan/PlanCreationProgress.tsx (new)
    - Rich progress panel for 30-60s plan creation operation
    - Props: active (boolean), error (string | null)
    - Elapsed timer: setInterval at 1s, resets on active transition
    - 5 time-based phases: Initializing (0s), Analyzing PRD (3s),
      Generating Technical Pack (10s), Building Checklist (20s), Finalizing Plan (35s)
    - Phase steps: dot indicators with done/active/pending states
    - Done phases: green dot + text; Active: accent-2 dot with pulse; Pending: muted
    - Animated progress bar: fills to 95% based on elapsed/expected ratio (45s expected)
    - Shimmer animation on progress bar fill for visual feedback
    - Phase description: italic text describing current operation
    - Error state: replaces progress with red error message
    - formatElapsed helper: "Xs" or "Xm YYs" format
    - Accessible: role="progressbar" with aria-valuenow/min/max
  - src/renderer/components/plan/PlanCreationProgress.module.css (new)
    - .container: brutalist panel with border, shadow, flex column layout
    - .header: flex row with title and elapsed timer
    - .elapsed: mono font, accent-2 color for timer display
    - .progressTrack: 8px height, bordered, rounded pill
    - .progressBar: accent-2 fill, 1s linear width transition
    - .progressBar::after: shimmer gradient animation (2s infinite)
    - .phaseSteps: flex-wrap row of phase step indicators
    - .phaseStep: flex row with dot + label
    - .phaseStepDone: green dot + text
    - .phaseStepActive: accent-2 dot with phasePulse animation + bold text
    - .phaseStepPending: muted soft dot + text
    - .phaseDescription: italic muted text for current phase info
    - .errorText: red bold text for error display
  - src/renderer/App.tsx
    - Added PlanCreationProgress import
    - Replaced "Generating..." button text with static "Generate Ralph Plan"
    - Added PlanCreationProgress panel below button (active=creatingPlan, error during creation)
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-06: Make TaskCards collapsible with summary/expand behavior   [DONE]
  - src/renderer/components/plan/TaskCard.tsx
    - Removed internal useState for expanded; now fully controlled by parent
    - New required props: expanded (boolean), onToggleExpand (taskId: string) => void
    - Collapsed state shows: ordinal number, task title, status pill (header only)
    - Expanded state shows: full description, dependencies, acceptance criteria,
      technical notes, and action buttons
    - Toggle click calls onToggleExpand(task.id) instead of local setState
    - Existing CSS grid-template-rows 200ms animation preserved for smooth expand/collapse
  - src/renderer/views/PlanDetailView.tsx
    - Added expandedTaskIds state: Set<string> tracking which task cards are open
    - handleToggleExpand callback: toggles a single task ID in/out of the set
    - handleExpandAll callback: adds all task IDs to the expanded set
    - handleCollapseAll callback: clears the expanded set to empty
    - allExpanded derived boolean: true when all tasks are in the expanded set
    - Auto-expand effect: on plan load or task status change, automatically adds
      tasks with status "in_progress" or "failed" to the expanded set
    - Checklist header: added checklistActions container with "Expand All" / "Collapse All"
      toggle button alongside existing "Run Next Available Tasks" button
    - Toggle button label switches based on allExpanded state
    - TaskCard instances now receive expanded and onToggleExpand props
  - src/renderer/views/PlanDetailView.module.css
    - .checklistActions: flex row container for header action buttons
    - .expandCollapseBtn: ghost-style brutalist button (2px border, bold, --font-sans)
    - Hover translateY(-1px) micro-interaction, focus-visible outline for accessibility
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-07: Add keyboard shortcuts for common actions   [DONE]
  - src/renderer/hooks/useKeyboardShortcuts.ts (new)
    - ShortcutDefinition interface: id, key, ctrl?, shift?, alt?, label, description,
      category?, preventDefault?, handler
    - formatShortcutKeys(def): returns human-readable key label, adapts to macOS vs Windows
      (uses Cmd symbol on Mac, "Ctrl" on Windows/Linux)
    - useKeyboardShortcuts(shortcuts, enabled?): global keydown listener on document
      in capture phase
    - Skips shortcuts when focused on INPUT/TEXTAREA/SELECT/contentEditable elements,
      unless the shortcut requires Ctrl (Ctrl+key combos are not normal typing)
    - Uses stable ref pattern to avoid re-registering listener on handler changes
    - Fires only the first matching shortcut per keystroke
    - Exports ShortcutDefinition, formatShortcutKeys, useKeyboardShortcuts
  - src/renderer/components/KeyboardShortcutHelp/KeyboardShortcutHelp.tsx (new)
    - Modal dialog showing all registered keyboard shortcuts grouped by category
    - Uses UModal with title "Keyboard Shortcuts"
    - Groups shortcuts by category field (defaults to "General")
    - Each shortcut rendered as row: kbd badge (mono font, bordered, shadow) + description
    - Category headings: uppercase, bold, dashed border separator
    - Footer hint: "Press Esc to close this dialog."
    - Exports KeyboardShortcutHelpProps, KeyboardShortcutHelp
  - src/renderer/components/KeyboardShortcutHelp/KeyboardShortcutHelp.module.css (new)
    - .dialog: max-width 600px override for UModal
    - .kbd: inline-flex badge with mono font, 2px border, box-shadow (key-cap style)
    - .kbdInline: smaller inline key badge for footer hint
    - .groupTitle: uppercase, bold, dashed border-bottom category header
    - .row: flex row with kbd + desc, soft border separators
    - .hint: centered muted footer text
    - Responsive: smaller kbd badges below 480px
    - All values reference tokens.css custom properties
  - src/renderer/components/AppShell/AppShell.tsx
    - Added useNavigate, useState, useMemo, useCallback imports
    - Registers 7 keyboard shortcut definitions via useKeyboardShortcuts:
      Ctrl+N -> navigate to /discovery (new plan/discovery)
      Ctrl+R -> run all tasks on current plan detail page (preventDefault)
      Escape -> cancel current run on /run/:runId page
      Ctrl+F -> focus search input on plan list page (querySelector by aria-label)
      Ctrl+, -> navigate to /settings
      Ctrl+/ -> open keyboard shortcut help dialog
      ? (Shift+/) -> open keyboard shortcut help dialog
    - helpOpen state + openHelp/closeHelp callbacks control help dialog visibility
    - Shortcuts stored in config object (useMemo) for easy maintenance
    - Renders KeyboardShortcutHelp dialog at root level, receives full shortcuts array
    - Ctrl+N, Ctrl+R, Ctrl+F, Ctrl+, all call preventDefault to suppress browser defaults
  - src/renderer/components/layout/Sidebar.tsx
    - NavItem interface: added optional shortcutHint field
    - NAV_ITEMS: Discovery gets "Ctrl+N" hint, Settings gets "Ctrl+," hint
    - NavLink title attribute: shows "Label (shortcutHint)" when hint exists
    - "New Plan" button: title set to "New Plan (Ctrl+N)"
  - src/renderer/views/PlanDetailView.tsx
    - "Run Next Available Tasks" button: added title="Run Next Available Tasks (Ctrl+R)"
    - "Cancel Run" button: added title="Cancel Run (Esc)"
  - src/renderer/views/PlanListView.tsx
    - Search input: placeholder updated to include "(Ctrl+F)" hint
    - Search input: added title="Search plans (Ctrl+F)"
  - src/renderer/views/LiveRunView.tsx
    - "Cancel Run" button: added title="Cancel Run (Esc)"
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-08: Cap log accumulation with ring buffer in runStore   [DONE]
  - src/renderer/stores/runStore.ts
    - Imported RingBuffer from P1-07 (src/renderer/components/ui/RingBuffer.ts)
    - LOG_BUFFER_CAPACITY constant: 5_000 (max in-memory log lines per run)
    - Module-level logBuffers Map<string, RingBuffer<string>>: stores ring buffer instances
      outside Zustand/immer state to avoid proxy overhead on mutable containers
    - Module-level totalPushed Map<string, number>: tracks total lines pushed per runId
      (including those dropped by the ring buffer) for overflow calculation
    - getLogBuffer(runId): lazily creates a RingBuffer<string> per run
    - pushToBuffer(runId, line): pushes to ring buffer, increments totalPushed,
      returns overflow count (max(0, totalPushed - capacity))
    - runLogOverflow state: Record<string, number> tracking dropped line count per run
    - appendLog action: pushes to ring buffer, sets runLogs[runId] from buf.toArray(),
      sets runLogOverflow[runId] from overflow count
    - _handleRunEvent "log" case: same ring buffer logic (pushToBuffer + toArray)
    - DB persistence (appendRunEvent in main process) is completely unaffected;
      ring buffer only caps the in-memory display window
  - src/renderer/components/ui/ULogViewer.tsx
    - ULogViewerProps: added truncatedCount optional prop (number, default 0)
    - Footer: when truncatedCount > 0, renders a truncation indicator span showing
      "{N} older lines truncated" (formatted with toLocaleString for readability)
  - src/renderer/components/ui/ULogViewer.module.css
    - .truncatedIndicator: accent-2 color, bold weight, 0.7rem font-size, nowrap
  - src/renderer/views/LiveRunView.tsx
    - Reads runLogOverflow from runStore via selector
    - Derives logOverflow number for current runId
    - Passes truncatedCount={logOverflow} to ULogViewer
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)

p3-09: Preserve IPC error context in development mode   [DONE]
  - src/shared/types.ts
    - IpcZodIssue interface (new): path (string|number)[], message, code?, expected?, received?
    - IpcError interface (new): message, code, details? (IpcZodIssue[]), stack?
  - src/main/ipc.ts
    - isDev flag: derived from import.meta.env.DEV with process.env.NODE_ENV fallback
    - formatIpcError(error): returns structured IpcError instead of plain string
    - Zod v4 branch: maps ZodError.issues to IpcZodIssue[] with path, message, code,
      expected type, received value (dev only); dev message includes all field paths,
      prod message: "Invalid input."
    - Error branch: dev preserves original message + stack, prod: "An unexpected error occurred."
    - Unknown branch: dev uses String(error), prod: "An unexpected error occurred."
    - createIpcError(error): wraps structured IpcError as JSON in Error.message
      for Electron IPC serialization (.message is the only field that survives ipcMain.handle)
    - All 22 IPC handlers updated from `throw new Error(formatIpcError(error))` to
      `throw createIpcError(error)`
  - src/renderer/services/ipcErrorService.ts (new)
    - parseIpcError(caught): extracts JSON IpcError from Electron-wrapped error messages
    - extractJsonFromMessage(message): brace-balanced JSON extraction from prefixed messages
      (handles "Error invoking remote method '<channel>': Error: {json}" pattern)
    - getIpcErrorMessage(caught): convenience helper returning just the message string
    - hasIpcErrorDetails(error): checks if IpcError has details array or stack trace
  - src/renderer/components/ui/IpcErrorDetails.tsx (new)
    - IpcErrorDetails component: collapsible error details panel
    - Header: error code badge + message text
    - Toggle button: "Show Details" / "Hide Details" with chevron rotation
    - Expanded section: Zod validation issues list (path, message, expected/received, code)
      and stack trace in scrollable pre block
    - Only shows toggle when hasIpcErrorDetails returns true
  - src/renderer/components/ui/IpcErrorDetails.module.css (new)
    - Brutalist error panel: error-colored border, mono font, dashed separators
    - Toggle button: full-width, uppercase, hover highlight
    - Issue items: dashed border cards with path (accent-2), message, meta row
    - Stack trace: mono pre block, 200px max-height, scrollable
    - All values reference tokens.css custom properties
  - src/renderer/components/ui.ts
    - Barrel export: IpcErrorDetails component and IpcErrorDetailsProps type
  - src/renderer/stores/planStore.ts
    - lastIpcError state: IpcError | null, cleared on each action start
    - All catch blocks: replaced manual message extraction with parseIpcError()
    - Sets both error (string) and lastIpcError (IpcError) for backward compatibility
    - toastService.error calls use parsed ipcError.message
  - Build and typecheck pass (pre-existing task-runner.ts TS2352 error unrelated to this task)